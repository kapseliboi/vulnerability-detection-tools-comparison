# vulnerability-detection-tools-comparison
This repository contains scripts for running multiple vulnerability detection tools at once


## Requirements

- Node.js >= 16 and npm >= 7
- Git
- OWASP Dependency Check CLI (I used version 6.2.2, installation: https://jeremylong.github.io/DependencyCheck/dependency-check-cli/)
- Yarn (required by dependency check)
- Ruby + bundle-audit (otherwise dependency check will throw errors when it tries to scan ruby code)
- Authenticated Snyk CLI installed (I used version 1.658.0)
- Authenticated GitHub CLI or unauthenticated with an access token
- Unix find command available in path
- GitHub.com enterprise account (without it dependabot results might be incorrect: https://docs.github.com/en/code-security/supply-chain-security/managing-vulnerabilities-in-your-projects-dependencies/troubleshooting-the-detection-of-vulnerable-dependencies#are-there-limits-which-affect-the-dependency-graph-data)

## Functionality

### How I used this script?

1. I used my search parameters in GithHub search (https://seart-ghs.si.usi.ch/) and downloaded the results as JSON from there
2. I would randomize the order of projects in the result file using command `node build/index.js randomizeSearchResultItemOrder --inputFiles results.json`. Note: this command requires running npm build first. You can also run this command with ts-node.
3. Then I would use the select command. I needed to use multiple GitHub searches so I had multiple files. I wanted to preserve their relative size in the project selection as well and to do that I used this command: `node build/index.js select --inputFiles jsResults.json tsResults.json --groupSize 100 --minDepCount 100 --limit 200`. Here I basically say that use these input files to find projects on GitHub which have at least 100 dependencies. Find 200 automatically filtered projects per input file and then proceed to manually select projects from them in groups of 100. The groups basically means that you preserve the relative sizes of the different input files even in the selected projects.
4. After I had done the selection I would just run `node --max-old-space-size=10240 --inspect -r ts-node/register src/index.ts execute` Note that this requires a lot of RAM. I also ran this command using tee to save all output like this: `node --max-old-space-size=10240 build/index.js execute 2>&1 | tee executeLog.txt`

### Select

Selects projects based on a provided JSON file which has to be produced by GitHub Search or be in the same format. It checks the amount of dependencies in the repository and
if it meets the minimum requirement for dependencies it gives a link to the user to the repository for the user to manually inspect its suitability.
Then the user simply selects if it accepts it or not. Then the project is saved to the database for later analysis. This project uses TypeORM so the type of database is freely configurable.
Some extra work is also done regarding later analysis with repository based tools.
The project is forked and Dependabot is enabled using an authenticated GitHub CLI.

### Execute

Produces results with all the tools and saves them to database and if saving to files is enabled then also to ./results/${GitHub username}/${Repository name}/${Commit hash}

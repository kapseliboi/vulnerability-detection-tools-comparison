import { DetectionToolFunction } from "../interfaces/types";
import Path from 'path';

const func: DetectionToolFunction = (project, projectPath, resultsPath, packageJsonDirs) => {
    let cmd = ':';
    for (let i = 0; i < packageJsonDirs.length; ++i) {
        const npmAuditDepsPath = Path.join(resultsPath, `npmAuditDeps${i}.json`);
        const npmAuditVulnPath = Path.join(resultsPath, `npmAuditVuln${i}.json`);
        const dir = packageJsonDirs[i];
        cmd = `${cmd}; cd ${dir} && ((npm ls -a --json > ${npmAuditDepsPath}) || true) && npm audit --json > ${npmAuditVulnPath}`;
    }
    return cmd;
}

export default func;

import { env } from 'process';
import dotenv from 'dotenv';
import path from 'path';

dotenv.config();

function requiredEnv(key: string): string {
    const value = env[key];
    if (!value) {
        throw new Error(`Missing environment variable ${key}`);
    }
    return value;
}

export default {
    TMP_DIR_PATH: path.join(__dirname, '../tmp'),
    RESULTS_PATH: path.join(__dirname, '../results'),
    GITHUB_URL: 'https://github.com',
    GITHUB_USERNAME: requiredEnv('GITHUB_USERNAME'),
    GITHUB_TOKEN: requiredEnv('GITHUB_TOKEN'),
    GITHUB_GRAPHQL_API: 'https://api.github.com/graphql',
    GITHUB_GRAPHQL_API_SECURITY_PREVIEW_ACCEPT_HEADER: 'application/vnd.github.hawkgirl-preview+json',
    GITHUB_REST_API: 'https://api.github.com',
    GITHUB_REST_API_SECURITY_PREVIEW_ACCEPT_HEADER: 'application/vnd.github.dorian-preview+json',
    OWASP_DT_API_KEY: requiredEnv('OWASP_DT_API_KEY'),
    OWASP_DT_API_URL: requiredEnv('OWASP_DT_API_URL'),
    OWASP_DT_API_VERSION: requiredEnv('OWASP_DT_API_VERSION'),
    SELECT_FORK_WAIT_TIME_MS: parseInt(requiredEnv('SELECT_FORK_WAIT_TIME_MS')),
    URL_FETCHING_RATE_LIMIT_SECONDS: parseInt(env['URL_FETCHING_RATE_LIMIT_SECONDS'] || '1'),
    SONATYPE_OSSINDEX_EMAIL: requiredEnv('SONATYPE_OSSINDEX_EMAIL'),
    SONATYPE_OSSINDEX_PASSWORD: requiredEnv('SONATYPE_OSSINDEX_PASSWORD'),
    ENABLE_MULTITHREADING: !!env['ENABLE_MULTITHREADING'],
    // @ts-ignore
    usingTsNode: !!process[Symbol.for('ts-node.register.instance')],
};

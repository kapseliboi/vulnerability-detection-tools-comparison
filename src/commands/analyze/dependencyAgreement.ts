import { getManager } from 'typeorm';
import { Project } from '../../entities/project';
import { compareFnByProperty } from '../../util';

export async function analyzeDependencyAgreement() {
    const entityManager = getManager();
    console.log('Getting all projects');
    const allProjects = await entityManager.find(Project, {
        relations: [
            'toolExecutions',
            'toolExecutions.tool',
            'toolExecutions.dependencies',
            'toolExecutions.dependencies.package',
        ],
        order: {
            name: 'ASC',
        },
    });
    const equalityReviews = [];
    console.log('Sorting projects and project data for easier comparing');
    for (const project of allProjects) {
        project.toolExecutions.sort(compareFnByProperty('tool.name', 'tool.version'));
        for (const toolExec of project.toolExecutions) {
            toolExec.dependencies.sort(compareFnByProperty('package.name', 'version'));
        }
    }
}
